<!DOCTYPE html>  <html> <head>   <title>fnfmvc.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               fnfmvc.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>Building a client-side MVC app</h1>

<h2>with Backbone, Underscore and jQuery</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h3>Introduction</h3>

<p><ul>
<li>What is Backbone?</p>

<blockquote>
  <p>Backbone supplies structure to JavaScript-heavy applications by providing models with key-value binding and custom events, collections with a rich API of enumerable functions, views with declarative event handling, and connects it all to your existing application over a RESTful JSON interface. </li>
  </ul></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p><ul>
<li>What is Underscore.js?</p>

<blockquote>
  <p>Underscore is a utility-belt library for JavaScript that provides a 
  lot of the functional programming support that you would expect in 
  Prototype.js (or Ruby), but without extending any of the built-in 
  JavaScript objects. It's the tie to go along with jQuery's tux.</li>
  </ul></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p><ul>
<li>What is MVC?</p>

<blockquote>
  <p>It is a way to organize your GUI code into a delicious (?), 
  neatly separated sandwich. </li>
  </ul></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h3>Classic MVC refresher</h3>

<ol>
<li>Controller is the boss. He's in charge. He must be aware of everything you do.</li>
<li>Views react when the model changes.  <strong>That's it.</strong>  </li>
<li>Models contain data, but also <em>state</em>. I often forget this because of my stupid.</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h3>It is called a compound pattern because it is composed of other patterns, namely:</h3>

<ol>
<li><em>Observer</em> ( ie. events )  </li>
<li><em>Strategy</em> <br />
The view's controller is a strategy. It handles its behaviour
and can be swapped for another one if that needs to change.  </li>
<li><em>Composite</em> <br />
Views are a composite pattern - or at least can be - because
you group a bunch of little views inside a big one and can
address the big one have it deal with its children.</li>
</ol>

<h2>LET US NEVER SPEAK OF THIS AGAIN</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>In <em>Head Start: Design Patterns</em>, mp3 player example: <br />
1. Press play <br />
2. ( Controller is notified that you pressed play ) <br />
3. Controller tells model "Start playing NOW. Or else." <br />
4. Model starts playing; view is notified "I am playing this song" <br />
5. View displays the song you're playing</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">TODO:</span>
<span class="cm">When there&#39;s a validation error, make sure to trigger an event</span>
<span class="cm">so that the detail view can update itself accordingly (example:</span>
<span class="cm">there are no theaters showing that movie, the times are missing, etc)</span>
<span class="cm">*/</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Fizz, buzz</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">global</span><span class="p">){</span>

  <span class="kd">var</span> <span class="nx">DAYS</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sun&#39;</span><span class="p">,</span> <span class="s1">&#39;mon&#39;</span><span class="p">,</span> <span class="s1">&#39;tue&#39;</span><span class="p">,</span> <span class="s1">&#39;wed&#39;</span><span class="p">,</span> <span class="s1">&#39;thu&#39;</span><span class="p">,</span> <span class="s1">&#39;fri&#39;</span><span class="p">,</span> <span class="s1">&#39;sat&#39;</span><span class="p">]</span>
    <span class="p">,</span> <span class="nx">TODAY</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Our first model: Movie  </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">Movie</span>    <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>After Backbone creates an instance of a model, the 'initialize' method
will be invoked if it exists.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">detailed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>  
          <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">selectedDay</span> <span class="o">=</span> <span class="nx">DAYS</span><span class="p">[</span> <span class="nx">TODAY</span><span class="p">.</span><span class="nx">getDay</span><span class="p">()</span> <span class="p">];</span>
        <span class="p">}</span>

      <span class="p">,</span> <span class="nx">hasThumbnail</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>

          <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;thumbnail&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>                
  
        <span class="p">}</span>

      <span class="p">,</span> <span class="nx">url</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
  
          <span class="k">return</span> <span class="s1">&#39;/flicks/&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;?day=&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">selectedDay</span><span class="p">;</span>
    
        <span class="p">}</span>

      <span class="p">,</span> <span class="nx">selectDay</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">day</span> <span class="p">){</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span> <span class="p">{</span> <span class="nx">selectedDay</span><span class="o">:</span> <span class="nx">day</span> <span class="p">}</span> <span class="p">);</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>
        <span class="p">}</span>

      <span class="p">,</span> <span class="nx">expand</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">cb</span> <span class="p">){</span>
          <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    
          <span class="kd">function</span> <span class="nx">ex</span><span class="p">(</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">response</span> <span class="p">){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">detailed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="nx">cb</span><span class="p">();</span>
          <span class="p">};</span>
      
          <span class="k">this</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span> <span class="nx">success</span><span class="o">:</span> <span class="nx">ex</span>
                     <span class="p">,</span> <span class="nx">failure</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span> 
                         <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;OH NOES!&quot;</span><span class="p">);</span> 
                         <span class="nx">self</span><span class="p">.</span><span class="nx">detailed</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>  
                       <span class="p">}</span> 
                     <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">})</span>

  <span class="p">,</span> <span class="nx">Movies</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">url</span>   <span class="o">:</span> <span class="s1">&#39;/flicks&#39;</span>
      <span class="p">,</span> <span class="nx">model</span> <span class="o">:</span> <span class="nx">Movie</span>
      <span class="p">,</span> <span class="nx">withThumbnails</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span> 
            <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">){</span> 
              <span class="k">return</span> <span class="nx">m</span><span class="p">.</span><span class="nx">hasThumbnail</span><span class="p">();</span> 
            <span class="p">});</span>
        <span class="p">}</span>
      
      <span class="p">,</span> <span class="nx">selectMovie</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">movie</span> <span class="p">){</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">selectedMovie</span> <span class="o">=</span> <span class="nx">movie</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">})</span>
  

  <span class="p">,</span> <span class="nx">MovieThumb</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    
        <span class="nx">tagName</span>   <span class="o">:</span> <span class="s1">&#39;li&#39;</span>
      <span class="p">,</span> <span class="nx">className</span> <span class="o">:</span> <span class="s1">&#39;flick&#39;</span>
      <span class="p">,</span> <span class="nx">tpl</span>       <span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span>
          <span class="s1">&#39;&lt;a href=&quot;#/flicks/&lt;%= id %&gt;&quot;&gt;&#39;</span>
        <span class="o">+</span> <span class="s1">&#39;&lt;img src=&quot;&lt;%= thumbnail %&gt;&quot; title=&quot;&lt;%= title %&gt;&quot;/&gt;&lt;/a&gt;&#39;</span> <span class="p">)</span>
    
      <span class="p">,</span> <span class="nx">events</span>    <span class="o">:</span> <span class="p">{</span>

          <span class="s1">&#39;click&#39;</span> <span class="o">:</span> <span class="s1">&#39;select&#39;</span>
        
        <span class="p">}</span>

      <span class="p">,</span> <span class="nx">select</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
          
          <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">);</span>
          </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>this.trigger( 'moviethumb:selected', this, this.model );</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">}</span>
      
      <span class="p">,</span> <span class="nx">deselect</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        
          <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">);</span>
        
        <span class="p">}</span>
        
      <span class="p">,</span> <span class="nx">href</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">);</span>

        <span class="p">}</span>

      <span class="p">,</span> <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">tpl</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span> <span class="p">);</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">}</span>
    
    <span class="p">})</span>

      
  <span class="p">,</span> <span class="nx">MovieGrid</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  
        <span class="nx">tagName</span><span class="o">:</span> <span class="s1">&#39;ul&#39;</span>
      
      <span class="p">,</span> <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>

          <span class="k">this</span><span class="p">.</span><span class="nx">movies</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">;</span>
      </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>When the collection refreshes, draw the view. 
Notice '_.bind(refresh, this)' -- this is because when the 
event fires, "this" would be set to the collection object
instead of the view object, which is what we want</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">this</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span> <span class="s1">&#39;refresh&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span> <span class="p">);</span>
        </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Highlight the movie that's been selected in the collection.</p>             </td>             <td class="code">               <div class="highlight"><pre>           
          <span class="k">this</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span> <span class="s1">&#39;moviethumb:selected&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">highlight</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>

          <span class="k">this</span><span class="p">.</span><span class="nx">detail</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MovieDetail</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">thumbs</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="p">}</span>
      
      <span class="p">,</span> <span class="nx">refresh</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">movies</span> <span class="p">){</span>
          
          <span class="kd">var</span> <span class="nx">mt</span><span class="p">;</span>
          
          <span class="nx">movies</span><span class="p">.</span><span class="nx">withThumbnails</span><span class="p">().</span><span class="nx">forEach</span><span class="p">(</span>

            <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">){</span>
              
              <span class="nx">mt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">thumb</span><span class="p">(</span> <span class="nx">m</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>When a movie thumbnail is selected, call the highlight method (and bind it first)</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="nx">mt</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span> <span class="s1">&#39;moviethumb:selected&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">highlight</span><span class="p">,</span> <span class="k">this</span> <span class="p">));</span>
              
              <span class="nx">$</span><span class="p">(</span> <span class="nx">mt</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span> <span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>            
            
            <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>
      
      <span class="p">,</span> <span class="nx">highlight</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">thumb</span><span class="p">,</span> <span class="nx">movie</span> <span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>And now a word about extending native prototypes.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">thumbs</span><span class="p">).</span><span class="nx">chain</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">without</span><span class="p">(</span> <span class="nx">thumb</span> <span class="p">)</span>
            <span class="p">.</span><span class="nx">invoke</span><span class="p">(</span> <span class="s1">&#39;deselect&#39;</span> <span class="p">);</span>       
          
          <span class="k">this</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span> <span class="nx">movie</span> <span class="p">);</span>
        <span class="p">}</span>
        
      <span class="p">,</span> <span class="nx">reset</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
          <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">thumbs</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">invoke</span><span class="p">(</span> <span class="s1">&#39;deselect&#39;</span> <span class="p">);</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>MovieThumb constructor method for convenience</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">,</span> <span class="nx">thumb</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">movie</span> <span class="p">){</span>
        
          <span class="kd">var</span> <span class="nx">thumb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MovieThumb</span><span class="p">({</span> <span class="nx">model</span><span class="o">:</span> <span class="nx">movie</span> <span class="p">});</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">thumbs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">thumb</span> <span class="p">);</span>
          <span class="k">return</span> <span class="nx">thumb</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="p">})</span>


  <span class="p">,</span> <span class="nx">MovieDetail</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
      <span class="nx">tagName</span><span class="o">:</span> <span class="s1">&#39;div&#39;</span>
    <span class="p">,</span> <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;flick-detail&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>When the events are triggered using Backbone's event
handling stuff for views, 'this' is set to the view,
rather than the element that triggered the element
(as you might expect with jQuery).    </p>             </td>             <td class="code">               <div class="highlight"><pre>    
    <span class="p">,</span> <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click a.close&#39;</span>     <span class="o">:</span> <span class="s1">&#39;close&#39;</span>
      <span class="p">,</span> <span class="s1">&#39;change select.day&#39;</span> <span class="o">:</span> <span class="s1">&#39;pickDay&#39;</span>
      <span class="p">}</span>

    <span class="p">,</span> <span class="nx">tpl</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span>
          <span class="s1">&#39;&lt;a class=&quot;close&quot; href=&quot;#/flicks&quot;&gt;&lt;/a&gt;&#39;</span>
        <span class="o">+</span> <span class="s1">&#39;&lt;img src=&quot;&lt;%= posters[0].href %&gt;&quot;&gt;&#39;</span>
        <span class="o">+</span> <span class="s1">&#39;&lt;h3&gt;&lt;%= title %&gt;&lt;/h3&gt;&#39;</span>
        <span class="o">+</span> <span class="s1">&#39;&lt;p&gt;&lt;%= plot %&gt;&lt;/p&gt;&#39;</span>
        <span class="o">+</span> <span class="s1">&#39;&lt;div class=&quot;daytime&quot;&gt;&#39;</span>
        <span class="o">+</span> <span class="s1">&#39;&lt;select class=&quot;day&quot;&gt;&lt;/select&gt;&amp;nbsp;&#39;</span>
        <span class="o">+</span> <span class="s1">&#39;&lt;select class=&quot;time&quot;&gt;&lt;/select&gt;&#39;</span>
        <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span>
      <span class="p">)</span>
      
    <span class="p">,</span> <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        
        <span class="kd">var</span> <span class="nx">movie</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">;</span>
        
        <span class="nx">movie</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span> <span class="s1">&#39;changed:state&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                    
          <span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">movie</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">);</span>
          
          <span class="k">if</span> <span class="p">(</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;detailed&#39;</span><span class="p">){</span>
           
            <span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
            
          <span class="p">}</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
      
      <span class="p">}</span>
    <span class="p">,</span> <span class="nx">pickDay</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;picked a day&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;select.day&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;moviedetail:daypick&#39;</span><span class="p">,</span> <span class="nx">d</span><span class="p">);</span>
      <span class="p">}</span>

    <span class="p">,</span> <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>

        <span class="kd">var</span> <span class="nx">daylist</span><span class="p">,</span> <span class="nx">idx</span><span class="p">,</span> <span class="nx">dayabbr</span><span class="p">,</span> <span class="nx">moviedate</span>
          <span class="p">,</span> <span class="nx">movie</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span>
          <span class="p">,</span> <span class="nx">self</span>  <span class="o">=</span> <span class="k">this</span>
          <span class="p">,</span> <span class="nx">tag</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">make</span>
          <span class="p">,</span> <span class="nx">today</span> <span class="o">=</span> <span class="nx">TODAY</span><span class="p">.</span><span class="nx">getDay</span><span class="p">()</span>
          <span class="p">,</span> <span class="nx">j</span>
          <span class="p">;</span>

        <span class="nx">$</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span> <span class="p">).</span><span class="nx">html</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">tpl</span><span class="p">(</span><span class="nx">movie</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span> <span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
          <span class="nx">j</span> <span class="o">=</span> <span class="p">(</span><span class="nx">today</span> <span class="o">+</span> <span class="nx">i</span><span class="p">)</span> <span class="o">%</span> <span class="nx">DAYS</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
          
          <span class="nx">$</span><span class="p">(</span> <span class="nx">tag</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span>  <span class="nx">DAYS</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="p">},</span> <span class="nx">DAYS</span><span class="p">[</span><span class="nx">j</span><span class="p">])</span> <span class="p">)</span>
            <span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;select.day&#39;</span><span class="p">)</span> <span class="p">);</span>
        <span class="p">}</span>


        <span class="kd">function</span> <span class="nx">updateTimes</span><span class="p">(){</span>
          
          <span class="kd">var</span> <span class="nx">movie</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;select.time&#39;</span><span class="p">).</span><span class="nx">empty</span><span class="p">();</span>
          
          <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span> <span class="nx">movie</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">theaters</span><span class="p">,</span> 
          
            <span class="kd">function</span><span class="p">(</span><span class="nx">theater</span><span class="p">){</span>
            
              <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="p">(</span> <span class="nx">theater</span><span class="p">.</span><span class="nx">times</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span>
              
                <span class="nx">$</span><span class="p">(</span> <span class="nx">tag</span><span class="p">(</span> <span class="s1">&#39;option&#39;</span>
                      <span class="p">,</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">theater</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="nx">t</span> <span class="p">}</span>
                      <span class="p">,</span> <span class="nx">t</span> <span class="o">+</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="nx">theater</span><span class="p">.</span><span class="nx">name</span>
                      <span class="p">))</span>
                <span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;select.time&#39;</span><span class="p">)</span> <span class="p">);</span>
            
              <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
            
            <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">updateTimes</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        
        <span class="nx">movie</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span> <span class="s1">&#39;change:theaters&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">updateTimes</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span> <span class="p">);</span>
        
        <span class="nx">$</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="err"> </span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">);</span>      
        <span class="k">this</span><span class="p">.</span><span class="nx">rendered</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>

  
    <span class="p">,</span> <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">movie</span> <span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="o">=</span> <span class="nx">movie</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nx">movie</span><span class="p">.</span><span class="nx">detailed</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">movie</span><span class="p">.</span><span class="nx">fetch</span> <span class="p">({</span> <span class="nx">success</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">movie</span><span class="p">)</span> <span class="p">});</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">rendered</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>      
    
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="nx">movie</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">thumbnail</span> <span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span> <span class="nx">movie</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">title</span> <span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span> <span class="nx">movie</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">plot</span> <span class="p">);</span>

        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">position</span><span class="p">({</span>      
            <span class="nx">my</span><span class="o">:</span> <span class="s1">&#39;center&#39;</span>
          <span class="p">,</span> <span class="nx">at</span><span class="o">:</span> <span class="s1">&#39;center&#39;</span>
          <span class="p">,</span> <span class="nx">of</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span>
        <span class="p">}).</span><span class="nx">show</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;moviedetail:show&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>
    
    <span class="p">,</span> <span class="nx">close</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;moviedetail:close&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">})</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>The application view</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">,</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    
      <span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Food &amp; Flicks&#39;</span>  
    <span class="p">,</span> <span class="nx">el</span>    <span class="o">:</span> <span class="s1">&#39;div.flicks&#39;</span>    
    
    <span class="p">,</span> <span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      
        <span class="k">this</span><span class="p">.</span><span class="nx">grid</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MovieGrid</span><span class="p">({</span> <span class="nx">model</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">detail</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MovieDetail</span><span class="p">;</span>
        
      <span class="p">}</span>
      
    <span class="p">,</span> <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>    
        <span class="nx">$</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">grid</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span> <span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span> <span class="p">);</span> 
      <span class="p">}</span>

    <span class="p">});</span>

<span class="cm">/*</span>

<span class="cm">  The controller instantiate the model.</span>
<span class="cm">  </span>
<span class="cm">  The controller instantiates views, passing in the model:</span>
<span class="cm">  </span>
<span class="cm">      The view binds to model events and initializes to current model state</span>
<span class="cm">      </span>
<span class="cm">  The controller binds to view events </span>
<span class="cm">      </span>
<span class="cm">      Upon an event, the controller updates the model</span>
<span class="cm">      </span>
<span class="cm">  The controller triggers model changes ( changes the model )</span>
<span class="cm">  </span>
<span class="cm">*/</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>The FNF controller is the 'main' controller for application.
Backbone controllers are essentially a convenience to keep
track of the hash fragment of the URL and dispatch accordingly.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">FNF</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

    <span class="nx">routes</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;/flicks&#39;</span>          <span class="o">:</span> <span class="s1">&#39;flicks&#39;</span>
      <span class="p">,</span> <span class="s1">&#39;/flicks/:flick&#39;</span>   <span class="o">:</span> <span class="s1">&#39;detail&#39;</span>
      <span class="p">,</span> <span class="s1">&#39;/soirees/:soiree&#39;</span> <span class="o">:</span> <span class="s1">&#39;soiree&#39;</span>
    <span class="p">}</span>

  <span class="p">,</span> <span class="nx">flicks</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span> 
      
      <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
    
    <span class="p">}</span>

  <span class="p">,</span> <span class="nx">detail</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">id</span> <span class="p">){</span>
      
      <span class="kd">var</span> <span class="nx">movie</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="nx">id</span> <span class="p">)</span>
        
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">movie</span><span class="p">.</span><span class="nx">detailed</span><span class="p">){</span> 
        <span class="nx">movie</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span> <span class="nx">success</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">detail</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span> <span class="p">});</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="nx">movie</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;detail&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Starts the application
The 'movies' parameter is passed directly to this method
from the index.haml to bootstrap the application.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">,</span> <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">movies</span> <span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Initialize a collection of movie models</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">movies</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Movies</span><span class="p">;</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">({</span> <span class="nx">model</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">movies</span> <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>When the detail view is closed, reset the grid to its initial state</p>             </td>             <td class="code">               <div class="highlight"><pre>    
      <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;moviedetail:close&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>    

        <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">grid</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
      
      <span class="p">},</span> <span class="k">this</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>'this' is going to be the detail view</p>             </td>             <td class="code">               <div class="highlight"><pre>      
      <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;moviedetail:daypick&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">day</span><span class="p">){</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">selectDay</span><span class="p">(</span> <span class="nx">day</span> <span class="p">);</span>

      <span class="p">});</span>
      
      <span class="k">this</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">refresh</span><span class="p">(</span> <span class="nx">movies</span> <span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Backbone.history is what is used internally by the controllers.
start() begins the process by triggering the events bound to 
the current URL hash fragment.</p>             </td>             <td class="code">               <div class="highlight"><pre>      
      <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
    <span class="p">}</span>

  <span class="p">});</span>
  
  <span class="nx">global</span><span class="p">.</span><span class="nx">FNF</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FNF</span><span class="p">;</span>


<span class="p">}(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nb">window</span><span class="p">));</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 